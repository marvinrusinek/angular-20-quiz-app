@let opts = optionBindings || [];

@if (canShowOptions()) {
  <!-- OPTIONS ARE READY -->
  <form [formGroup]="form" class="options-form">
    @switch (type) {
      <!-- SINGLE-ANSWER (RADIO) -->
      @case ('single') {
        <mat-radio-group class="options-group options" formControlName="selectedOptionId">
          @for (b of optionBindings; let i = $index; track trackByOptionId(i, b)) {
            <mat-radio-button class="option-row single-option"
              appHighlightOption
              [value]="b.option.optionId"
              [checked]="b.isSelected"
              [sharedOptionConfig]="getSharedOptionConfig(b, i)"
              [ngClass]="getOptionClasses(b)"
              (change)="onOptionChanged(b, i, $event)"
              (click)="onHostClick($event, b, i)"
              [appHighlightInputType]="'radio'"
              [appHighlightReset]="shouldResetBackground"
            >
              <ng-container *ngTemplateOutlet="optionContent;
                  context: { $implicit: b, index: i }"></ng-container>
              </mat-radio-button>

              <ng-container *ngTemplateOutlet="optionFeedback;
                  context: { $implicit: b }"></ng-container>
          }
        </mat-radio-group>
      }

      <!-- MULTIPLE-ANSWER (CHECKBOX) -->
      @case ('multiple') {
        @for (b of optionBindings; let i = $index; track trackByOptionId(i, b)) {
          <mat-checkbox class="option-row multiple-option"
            appHighlightOption
            [checked]="b.isSelected"
            [sharedOptionConfig]="getSharedOptionConfig(b, i)"
            [ngClass]="getOptionClasses(b)"
            (change)="onOptionChanged(b, i, $event)"
            (click)="onHostClick($event, b, i)"
            [appHighlightInputType]="'checkbox'"
            [appHighlightReset]="shouldResetBackground"
            >
            
            <ng-container *ngTemplateOutlet="optionContent;
              context: { $implicit: b, index: i }"></ng-container>
          </mat-checkbox>

          <ng-container *ngTemplateOutlet="optionFeedback;
            context: { $implicit: b }"></ng-container>
        }
      }
    }
    <!-- end @switch -->

    <ng-template #optionContent let-b let-i="index">
      <div class="option-wrapper" (click)="onDivClick($event, b, i)">
        <span class="option-text">{{ getOptionDisplayText(b.option, i) }}</span>

        @if (shouldShowIcon(b.option, i)) {
          <mat-icon class="opt-icon">{{ getOptionIcon(b.option, i) }}</mat-icon>
        }
      </div>
    </ng-template>

    <ng-template #optionFeedback let-b>
      @if (b.option.optionId === lastFeedbackOptionId) {
        <div class="feedback-wrapper">
          @if (feedbackConfigs[b.option.optionId]?.showFeedback) {
            <codelab-quiz-feedback 
              [feedbackConfig]="feedbackConfigs[b.option.optionId]" />
          }
        </div>
      }
    </ng-template>
  </form>
} @else if (opts.length === 0) {
  <span>Options not ready&hellip;</span>
}