@let opts = optionBindings || [];

@if (canShowOptions()) {
  <!-- OPTIONS ARE READY -->
  <form
    [formGroup]="form"
    class="options-form"
  >
    @switch (type) {
      <!-- SINGLE-ANSWER (RADIO) -->
      @case ('single') {
        <mat-radio-group
          class="options-group options"
          formControlName="selectedOptionId"
        >
          @for (b of optionBindings; track trackByOptionId(b, i); let i = $index) {
            <mat-radio-button
              class="option-row single-option"
              appHighlightOption
              [appHighlightInputType]="'radio'"
              [appHighlightReset]="shouldResetBackground"
              [sharedOptionConfig]="getSharedOptionConfig(b, i)"
              [value]="b.option.optionId"
              [ngClass]="getOptionClasses(b)"
              [disabled]="isDisabled(b, i)"
              [disableRipple]="true"
              (change)="onOptionChanged(b, i, $event)"
              (click)="onOptionInteraction(b, i, $event)"
            >
              <ng-container
                *ngTemplateOutlet="optionContent; context: { $implicit: b, index: i }"
              ></ng-container>
            </mat-radio-button>

            <ng-container
              *ngTemplateOutlet="optionFeedback; context: { $implicit: b }"
            ></ng-container>
          }
        </mat-radio-group>
      }

      <!-- MULTIPLE-ANSWER (CHECKBOX) -->
      @case ('multiple') {
        <div
          class="options-group options"
          role="group"
          aria-label="Select one or more options"
        >
          @for (b of optionBindings; track trackByOptionId(b, i); let i = $index) {
            <mat-checkbox
              class="option-row multiple-option"
              appHighlightOption
              [appHighlightInputType]="'checkbox'"
              [appHighlightReset]="shouldResetBackground"
              [sharedOptionConfig]="getSharedOptionConfig(b, i)"
              [checked]="b.isSelected"
              [ngClass]="getOptionClasses(b)"
              [disabled]="isDisabled(b, i)"
              [disableRipple]="true"
              (change)="onOptionChanged(b, i, $event)"
              (click)="onOptionInteraction(b, i, $event)"
            >
              <ng-container
                *ngTemplateOutlet="optionContent; context: { $implicit: b, index: i }"
              ></ng-container>
            </mat-checkbox>

            <ng-container
              *ngTemplateOutlet="optionFeedback; context: { $implicit: b }"
            ></ng-container>
          }
        </div>
      }
    }

    <!-- OPTION CONTENT -->
    <ng-template
      #optionContent
      let-b
      let-i="index"
    >
      <div
        class="option-wrapper"
        (click)="onOptionContentClick(b, i, $event)"
      >
        <span class="option-text">
          {{ getOptionDisplayText(b.option, i) }}
        </span>

        @if (shouldShowIcon(b.option, i)) {
          <mat-icon class="opt-icon">
            {{ getOptionIcon(b.option, i) }}
          </mat-icon>
        }
      </div>
    </ng-template>

    <!-- OPTION FEEDBACK (ANIMATED HERE) -->
    <ng-template
      #optionFeedback
      let-b
    >
      @if (shouldShowFeedbackFor(b)) {
        <div
          class="feedback-wrapper"
          @correctAnswer
        >
          <codelab-quiz-feedback
            [feedbackConfig]="feedbackConfigs[b.option.optionId]" />
        </div>
      }
    </ng-template>
  </form>
} @else if (opts.length === 0) {
  <span>Options not ready&hellip;</span>
}
